<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­èˆˆç”·å®¿å…¬å€æŠ½ç±¤ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
    <style>
        :root { --primary-green: #2d6a4f; --light-green: #d8f3dc; --accent-green: #52b788; --success-bg: #b7e4c7; --text-color: #1b4332; }
        body { font-family: "PingFang TC", sans-serif; background: var(--light-green); display: flex; justify-content: center; padding: 20px; color: var(--text-color); }
        .card { width: 100%; max-width: 600px; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(27, 67, 50, 0.15); position: relative; }
        .settings-btn { position: absolute; top: 25px; right: 25px; font-size: 24px; cursor: pointer; color: #95d5b2; }
        h2 { text-align: center; color: var(--primary-green); margin-bottom: 5px; }
        .sync-info { text-align: center; background: #f0fdf4; padding: 8px; border-radius: 10px; font-size: 13px; color: var(--primary-green); margin-bottom: 20px; border: 1px solid #dcfce7; }
        .dorm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .dorm-box { background: #fff; border: 2px solid #e9ecef; border-radius: 16px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; }
        .dorm-box.drawn { background: var(--success-bg); border-color: var(--accent-green); }
        .result-text { font-weight: 800; font-size: 16px; color: var(--primary-green); margin: 5px 0; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(27, 67, 50, 0.7); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; }
        textarea, input { width: 100%; margin: 10px 0; padding: 12px; border: 2px solid #d8f3dc; border-radius: 12px; box-sizing: border-box; }
        .save-btn { width: 100%; padding: 14px; background: var(--primary-green); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="card">
        <div class="settings-btn" onclick="checkPassword()">âš™ï¸</div>
        <h2>ğŸŒ¿ æƒå€æŠ½ç±¤</h2>
        <div id="syncDisplay" class="sync-info">ç›®å‰åŒæ­¥åºè™Ÿï¼šæœªè¨­å®š</div>
        
        <div id="dormGrid" class="dorm-grid"></div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 15px 0;">âš™ï¸ ç®¡ç†èˆ‡åŒæ­¥è¨­å®š</h3>
            <label>ğŸ”‘ æŠ½ç±¤åºè™Ÿ (æ‰€æœ‰äººè¼¸å…¥ä¸€æ¨£çš„ï¼Œçµæœå°±ä¸€æ¨£)</label>
            <input type="text" id="seedInput" placeholder="ä¾‹å¦‚ï¼š20240520">
            
            <label>ğŸ›Œ å¯¢å®¤æ¸…å–®</label>
            <textarea id="dormsInput"></textarea>
            
            <label>ğŸ›ï¸ å…¬å…±æƒå€</label>
            <textarea id="zonesInput"></textarea>
            
            <button class="save-btn" onclick="saveAndRefresh()">å„²å­˜ä¸¦åŒæ­¥çµæœ</button>
            <p style="text-align:center; font-size:12px; color:#999; margin-top:15px; cursor:pointer;" onclick="toggleModal()">å–æ¶ˆ</p>
        </div>
    </div>

<script>
    const ADMIN_PASSWORD = "1234";
    let assignments = {};

    window.onload = function() {
        if (!localStorage.getItem('dorm_list')) {
            localStorage.setItem('dorm_list', "301\n302\n303\n304");
            localStorage.setItem('zone_list', "å»æ‰€\næµ´å®¤");
            localStorage.setItem('sync_seed', "12345"); 
        }
        initApp();
    };

    function checkPassword() {
        const pass = prompt("è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼ï¼š");
        if (pass === ADMIN_PASSWORD) toggleModal();
    }

    function toggleModal() {
        document.getElementById('dormsInput').value = localStorage.getItem('dorm_list');
        document.getElementById('zonesInput').value = localStorage.getItem('zone_list');
        document.getElementById('seedInput').value = localStorage.getItem('sync_seed');
        const modal = document.getElementById('settingsModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    function saveAndRefresh() {
        localStorage.setItem('dorm_list', document.getElementById('dormsInput').value);
        localStorage.setItem('zone_list', document.getElementById('zonesInput').value);
        localStorage.setItem('sync_seed', document.getElementById('seedInput').value);
        toggleModal();
        initApp();
    }

    function initApp() {
        const dorms = localStorage.getItem('dorm_list').trim().split('\n').filter(d => d.trim() !== "");
        const zones = localStorage.getItem('zone_list').trim().split('\n').filter(z => z.trim() !== "");
        const seed = localStorage.getItem('sync_seed') || "default";

        document.getElementById('syncDisplay').innerText = `åŒæ­¥åºè™Ÿï¼š${seed}`;

        // ä½¿ç”¨ seedrandom é–å®šéš¨æ©Ÿæ€§
        Math.seedrandom(seed);

        let pool = [...zones];
        while (pool.length < dorms.length) pool.push("âœ¨ è‡ªä¸»æ¸…æ½”");
        pool = pool.slice(0, dorms.length);
        
        // æ­¤è™•çš„ shuffle æœƒå—åˆ° seed å½±éŸ¿ï¼Œçµæœå›ºå®š
        for (let i = pool.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [pool[i], pool[j]] = [pool[j], pool[i]];
        }

        assignments = {};
        dorms.forEach((dorm, index) => assignments[dorm] = pool[index]);

        const grid = document.getElementById('dormGrid');
        grid.innerHTML = "";
        dorms.forEach(dorm => {
            const box = document.createElement('div');
            box.className = 'dorm-box';
            box.onclick = function() {
                this.classList.add('drawn');
                this.innerHTML = `<span style="font-size:18px; font-weight:bold;">${dorm}</span><div class="result-text">${assignments[dorm]}</div>`;
            };
            box.innerHTML = `<span style="font-size:18px; font-weight:bold;">${dorm}</span><div class="result-text">?</div>`;
            grid.appendChild(box);
        });
    }
</script>

</body>
</html>


