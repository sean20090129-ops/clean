<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­èˆˆç”·å®¿æŠ½æƒå€ç³»çµ±</title>
    <style>
        :root { 
            --primary-green: #2d6a4f; 
            --light-green: #d8f3dc;   
            --accent-green: #52b788;  
            --success-bg: #b7e4c7;    
            --text-color: #1b4332;
        }
        body { font-family: "PingFang TC", sans-serif; background: var(--light-green); display: flex; justify-content: center; padding: 20px; color: var(--text-color); }
        .card { width: 100%; max-width: 600px; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 10px 40px rgba(27, 67, 50, 0.15); position: relative; min-height: 400px; }
        
        /* é½’è¼ª */
        .settings-btn { position: absolute; top: 25px; right: 25px; font-size: 24px; cursor: pointer; color: #95d5b2; transition: 0.3s; z-index: 10; }
        .settings-btn:hover { transform: rotate(90deg); color: var(--primary-green); }

        h2 { text-align: center; color: var(--primary-green); margin-bottom: 5px; }
        .description { text-align: center; color: #74c69d; font-size: 14px; margin-bottom: 30px; }

        /* å¯¢å®¤æ ¼å­ */
        .dorm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .dorm-box { 
            background: #fff; border: 2px solid #e9ecef; border-radius: 16px; padding: 20px; 
            text-align: center; transition: all 0.3s ease; cursor: pointer; position: relative;
        }
        .dorm-box:hover { border-color: var(--accent-green); background: #f7fffb; transform: scale(1.03); }
        .dorm-box.drawn { background: var(--success-bg); border-color: var(--accent-green); cursor: default; transform: none; }
        
        .dorm-name { font-weight: bold; display: block; margin-bottom: 8px; font-size: 18px; }
        .result-text { font-weight: 800; font-size: 16px; color: var(--primary-green); margin: 5px 0; }
        .status-tag { font-size: 11px; color: #95d5b2; text-transform: uppercase; letter-spacing: 1px; }

        /* å½ˆçª— */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(27, 67, 50, 0.7); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        textarea { width: 100%; height: 80px; margin: 10px 0; padding: 12px; border: 2px solid #d8f3dc; border-radius: 12px; box-sizing: border-box; font-size: 14px; outline: none; }
        
        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .save-btn { padding: 14px; background: var(--primary-green); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .reset-action-btn { padding: 10px; background: #fff; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 12px; cursor: pointer; font-size: 13px; font-weight: bold; }
        .reset-action-btn:hover { background: #fdf2f2; }
    </style>
</head>
<body>

    <div class="card">
        <div class="settings-btn" onclick="checkPassword()">âš™ï¸</div>
        <h2>ğŸŒ¿ å®¿èˆæƒå€åˆ†é…</h2>
        <p class="description">è«‹é»æ“Šä¸‹æ–¹å¡ç‰‡æŠ½å–æœ¬é€±ä»»å‹™</p>
        
        <div id="dormGrid" class="dorm-grid"></div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 15px 0; color: var(--primary-green);">âš™ï¸ ç®¡ç†å“¡è¨­å®š</h3>
            <label style="font-size: 14px; font-weight:bold;">ğŸ›Œ å¯¢å®¤æ¸…å–®</label>
            <textarea id="dormsInput"></textarea>
            
            <label style="font-size: 14px; font-weight:bold;">ğŸ›ï¸ å…¬å…±æƒå€</label>
            <textarea id="zonesInput"></textarea>
            
            <div class="btn-group">
                <button class="save-btn" onclick="saveAndRefresh()">å„²å­˜ä¸¦é‡æ–°åˆ†é…</button>
                <button class="reset-action-btn" onclick="confirmReset()">ğŸ”„ æ¸…ç©ºé€²åº¦ (ä¿æŒç›®å‰åˆ†é…)</button>
            </div>
            <p style="text-align:center; font-size:12px; color:#999; margin-top:15px; cursor:pointer;" onclick="toggleModal()">å–æ¶ˆé—œé–‰</p>
        </div>
    </div>

<script>
    // --- è¨­å®šå€ ---
    const ADMIN_PASSWORD = "312"; // ä½ å¯ä»¥åœ¨é€™è£¡æ›´æ”¹å¯†ç¢¼
    // --------------

    let assignments = {};

    window.onload = function() {
        if (!localStorage.getItem('dorm_list')) {
            localStorage.setItem('dorm_list', "301\n302\n303\n304\n305");
            localStorage.setItem('zone_list', "å»æ‰€\næµ´å®¤\nåƒåœ¾å ´");
        }
        initApp();
    };

    function checkPassword() {
        const pass = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ä»¥é€²å…¥è¨­å®šï¼š");
        if (pass === ADMIN_PASSWORD) {
            toggleModal();
        } else if (pass !== null) {
            alert("å¯†ç¢¼éŒ¯èª¤ï¼Œæ‹’çµ•å­˜å–ï¼");
        }
    }

    function toggleModal() {
        document.getElementById('dormsInput').value = localStorage.getItem('dorm_list');
        document.getElementById('zonesInput').value = localStorage.getItem('zone_list');
        const modal = document.getElementById('settingsModal');
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    function saveAndRefresh() {
        localStorage.setItem('dorm_list', document.getElementById('dormsInput').value);
        localStorage.setItem('zone_list', document.getElementById('zonesInput').value);
        alert("è¨­å®šå·²å„²å­˜ï¼Œå°‡é‡æ–°ç”¢ç”Ÿéš¨æ©Ÿåˆ†é…çµæœï¼");
        toggleModal();
        initApp();
    }

    function confirmReset() {
        if(confirm("ç¢ºå®šè¦æ¸…ç©ºç›®å‰çš„æŠ½ç±¤é€²åº¦å—ï¼Ÿ(é€™æœƒè®“æ‰€æœ‰æ ¼å­è®Šå›æœªæŠ½å–ç‹€æ…‹ï¼Œä½†åˆ†é…çµæœä¸è®Š)")) {
            initApp();
            toggleModal();
        }
    }

    function initApp() {
        const dorms = localStorage.getItem('dorm_list').trim().split('\n').filter(d => d.trim() !== "");
        const zones = localStorage.getItem('zone_list').trim().split('\n').filter(z => z.trim() !== "");
        
        let pool = [...zones];
        while (pool.length < dorms.length) pool.push("âœ¨ è‡ªä¸»æ¸…æ½”");
        if (pool.length > dorms.length) pool = pool.slice(0, dorms.length);
        
        // Fisher-Yates Shuffle
        for (let i = pool.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [pool[i], pool[j]] = [pool[j], pool[i]];
        }

        assignments = {};
        dorms.forEach((dorm, index) => {
            assignments[dorm] = pool[index];
        });

        const grid = document.getElementById('dormGrid');
        grid.innerHTML = "";
        dorms.forEach(dorm => {
            const box = document.createElement('div');
            box.className = 'dorm-box';
            box.id = `dorm-${dorm}`;
            box.onclick = () => reveal(dorm);
            box.innerHTML = `
                <span class="status-tag">Wait</span>
                <span class="dorm-name">${dorm}</span>
                <div class="result-text" id="res-${dorm}">?</div>
            `;
            grid.appendChild(box);
        });
    }

    function reveal(dorm) {
        const box = document.getElementById(`dorm-${dorm}`);
        const text = document.getElementById(`res-${dorm}`);
        if (box.classList.contains('drawn')) return;

        text.innerText = "æŠ½å–ä¸­...";
        setTimeout(() => {
            text.innerText = assignments[dorm];
            box.classList.add('drawn');
            box.querySelector('.status-tag').innerText = "Confirmed";
        }, 400);
    }
</script>

</body>
</html>
